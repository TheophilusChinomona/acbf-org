import{a as e}from"./react-vendor-C9V0vZuX.js";import{R as a,a1 as r,aq as t,ar as s,a6 as i,Y as n,as as o,at as l,a4 as c,a5 as d,a7 as p,Z as m,W as u}from"./index-CCEhIy-z.js";async function b(e){const a=e.data(),r={id:e.id,...a};if(!a?.member_application_id)return r;try{const e=c(m,"membership_applications",a.member_application_id),t=await d(e);if(t.exists())return{...r,application:{id:t.id,...t.data()}}}catch(t){}return r}function f({listenToPendingMembers:f=!1}={}){const{currentUser:_}=a(),{userProfile:w,profileLoading:M,profileError:g,getUserProfile:y}=r(),[j,h]=e.useState([]),[E,v]=e.useState(f),[P,k]=e.useState(null);e.useEffect(()=>{if(!f)return h([]),void v(!1);v(!0),k(null);const e=t(n(m,"users"),s("role","==",i.MEMBER),s("status","==","pending")),a=o(e,async e=>{try{const a=await Promise.all(e.docs.map(b));h(a),k(null)}catch(a){k(a.message||"Failed to load pending members")}finally{v(!1)}},e=>{k(e.message||"Failed to listen to pending members"),v(!1)});return()=>a()},[f]);const x=e.useCallback(async(e=_?.uid)=>{if(!e)throw new Error("User ID is required to check member status");const a=await y(e);return a?{id:e,status:a.status??null,role:a.role??null,profile:a}:null},[_?.uid,y]),S=e.useCallback(async()=>{const e=t(n(m,"users"),s("role","==",i.MEMBER),s("status","==","pending")),a=await l(e);return Promise.all(a.docs.map(b))},[]),U=e.useCallback(async(e,a={})=>{if(!e)throw new Error("Member ID is required to approve a member");const r=_?.email||null,t=c(m,"users",e),s=await d(t);if(!s.exists())throw new Error("Member profile not found");const i=s.data();if(await p(t,{status:"approved",approved_at:u(),approved_by:r,rejection_reason:null,rejected_at:null,rejected_by:null,...a.additionalProfileUpdates}),i.member_application_id){const e=c(m,"membership_applications",i.member_application_id);try{await p(e,{status:"approved",approved_at:u(),approved_by:r})}catch(n){}}},[_?.email]),q=e.useCallback(async(e,a="Not specified",r={})=>{if(!e)throw new Error("Member ID is required to reject a member");const t=_?.email||null,s=c(m,"users",e),i=await d(s);if(!i.exists())throw new Error("Member profile not found");const n=i.data();if(await p(s,{status:"rejected",rejected_at:u(),rejected_by:t,rejection_reason:a,approved_at:null,approved_by:null,...r.additionalProfileUpdates}),n.member_application_id){const e=c(m,"membership_applications",n.member_application_id);try{await p(e,{status:"rejected",rejected_at:u(),rejected_by:t,rejection_reason:a})}catch(o){}}},[_?.email]),C=e.useMemo(()=>w?w.status??null:null,[w]);return{currentMember:w,memberStatus:C,memberProfileLoading:M,memberProfileError:g,pendingMembers:j,pendingMembersLoading:E,pendingMembersError:P,getMemberStatus:x,getPendingMembers:S,approveMember:U,rejectMember:q}}export{f as u};
