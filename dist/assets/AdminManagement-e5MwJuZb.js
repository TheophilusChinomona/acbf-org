import{j as e,m as s}from"./ui-vendor-D2jIcmjW.js";import{a as t,c as a}from"./react-vendor-C9V0vZuX.js";import{T as r,a3 as i,B as n,ad as l,F as d,w as c,t as o,aa as m,R as x,a2 as h,au as u,Y as p,Z as g,az as f,aw as j,a7 as b,an as y,m as N,A as v,aA as w,aB as M,_ as A,aq as D,h as k,V as I,u as _,ah as S}from"./index-sZWzWtYr.js";import{S as C,C as E}from"./SEO-FeRLgWmQ.js";import{S as F}from"./Section-B5vjyEy3.js";import{u as U,i as $}from"./useAdminInvitations-DZamp4DK.js";import{u as R}from"./form-vendor-DygO8_bV.js";import{t as P,c as z,n as T,g as H,e as X,a as B,m as L,b as Y,f as q}from"./format-DThRb344.js";function Z(e,s){const t=+P(e)-+P(s);return t<0?-1:t>0?1:t}function O(e,s){const t=P(e,s?.in);return+function(e,s){const t=P(e,s?.in);return t.setHours(23,59,59,999),t}(t,s)===+function(e,s){const t=P(e,s?.in),a=t.getMonth();return t.setFullYear(t.getFullYear(),a+1,0),t.setHours(23,59,59,999),t}(t,s)}function V(e,s,t){const[a,r,i]=T(t?.in,e,e,s),n=Z(r,i),l=Math.abs(function(e,s,t){const[a,r]=T(t?.in,e,s);return 12*(a.getFullYear()-r.getFullYear())+(a.getMonth()-r.getMonth())}(r,i));if(l<1)return 0;1===r.getMonth()&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-n*l);let d=Z(r,i)===-n;O(a)&&1===l&&1===Z(a,i)&&(d=!1);const c=n*(l-+d);return 0===c?0:c}function G(e,s,t){const a=function(e,s){return+P(e)-+P(s)}(e,s)/1e3;return(r=t?.roundingMethod,e=>{const s=(r?Math[r]:Math.trunc)(e);return 0===s?0:s})(a);var r}function J(e,s){return function(e,s,t){const a=H(),r=t?.locale??a.locale??X,i=Z(e,s);if(isNaN(i))throw new RangeError("Invalid time value");const n=Object.assign({},t,{addSuffix:t?.addSuffix,comparison:i}),[l,d]=T(t?.in,...i>0?[s,e]:[e,s]),c=G(d,l),o=(B(d)-B(l))/1e3,m=Math.round((c-o)/60);let x;if(m<2)return t?.includeSeconds?c<5?r.formatDistance("lessThanXSeconds",5,n):c<10?r.formatDistance("lessThanXSeconds",10,n):c<20?r.formatDistance("lessThanXSeconds",20,n):c<40?r.formatDistance("halfAMinute",0,n):c<60?r.formatDistance("lessThanXMinutes",1,n):r.formatDistance("xMinutes",1,n):0===m?r.formatDistance("lessThanXMinutes",1,n):r.formatDistance("xMinutes",m,n);if(m<45)return r.formatDistance("xMinutes",m,n);if(m<90)return r.formatDistance("aboutXHours",1,n);if(m<L){const e=Math.round(m/60);return r.formatDistance("aboutXHours",e,n)}if(m<2520)return r.formatDistance("xDays",1,n);if(m<Y){const e=Math.round(m/L);return r.formatDistance("xDays",e,n)}if(m<2*Y)return x=Math.round(m/Y),r.formatDistance("aboutXMonths",x,n);if(x=V(d,l),x<12){const e=Math.round(m/Y);return r.formatDistance("xMonths",e,n)}{const e=x%12,s=Math.trunc(x/12);return e<3?r.formatDistance("aboutXYears",s,n):e<9?r.formatDistance("overXYears",s,n):r.formatDistance("almostXYears",s+1,n)}}(e,function(e){return z(e,Date.now())}(e),s)}const K=[{label:"24 hours",value:24},{label:"3 days",value:72},{label:"7 days",value:168},{label:"14 days",value:336}],Q={email:"",name:"",note:"",ttlHours:168};function W({onCreateInvitation:s,onInvitationCreated:a,defaultTtlHours:x=168}){const{register:h,handleSubmit:u,reset:p,formState:{errors:g}}=R({defaultValues:{...Q,ttlHours:x}}),[f,j]=t.useState(!1),[b,y]=t.useState(null),[N,v]=t.useState(null),[w,M]=t.useState(!1),A=t.useMemo(()=>{if(!N?.token)return null;if("undefined"==typeof window)return`/invite/${N.token}`;return`${window.location?.origin||""}/invite/${N.token}`},[N]);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-1",children:"Invite a New Admin"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Send an invitation email to grant administrative access. Invitations include a secure link that expires after a set period."})]}),b&&e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700",children:[e.jsx(r,{className:"text-lg flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-900",children:"Invitation Failed"}),e.jsx("p",{children:b})]})]}),N&&e.jsxs("div",{className:"space-y-3 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(i,{className:"text-green-600 text-xl flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Invitation Created"}),e.jsx("p",{className:"text-sm text-green-700",children:"Share the invitation link with the invitee or let them know to check their email."})]})]}),e.jsxs("div",{className:"bg-white border border-green-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Invitation Link"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsx("code",{className:"flex-1 text-sm text-gray-800 break-all",children:A}),e.jsxs(n,{type:"button",onClick:async()=>{if(A)try{if(navigator?.clipboard?.writeText)await navigator.clipboard.writeText(A);else{const e=document.createElement("textarea");e.value=A,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}M(!0),setTimeout(()=>M(!1),3e3)}catch(e){M(!1)}},variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(l,{}),w?"Copied!":"Copy Link"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-600 flex items-start gap-2",children:[e.jsx(d,{className:"flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:["Invitation expires"," ",N.expires_at?new Date(N.expires_at).toLocaleString():"soon","."]})]})]}),e.jsxs("form",{onSubmit:u(async e=>{if(s){j(!0),y(null),M(!1);try{const t=await s({email:e.email,name:e.name,note:e.note,ttlHours:Number(e.ttlHours)});v(t),a&&a(t),p({...Q,ttlHours:e.ttlHours})}catch(t){y(t.message||"Unable to create invitation. Please try again.")}finally{j(!1)}}}),className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"invite-email",className:"block text-sm font-medium text-gray-700 mb-2",children:["Admin Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{id:"invite-email",type:"email",autoComplete:"email",placeholder:"admin@example.com",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors "+(g.email?"border-red-500":"border-gray-300"),...h("email",{required:"Email address is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Please enter a valid email address"}})})]}),g.email&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(r,{className:"text-xs"}),g.email.message]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"invite-name",className:"block text-sm font-medium text-gray-700 mb-2",children:["Invitee Name ",e.jsx("span",{className:"text-gray-400 font-normal",children:"(optional)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(o,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{id:"invite-name",type:"text",autoComplete:"name",placeholder:"Full name of invitee",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors",...h("name",{maxLength:{value:120,message:"Name must be 120 characters or fewer"}})})]}),g.name&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(r,{className:"text-xs"}),g.name.message]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"invite-note",className:"block text-sm font-medium text-gray-700 mb-2",children:["Personal Message ",e.jsx("span",{className:"text-gray-400 font-normal",children:"(optional)"})]}),e.jsx("textarea",{id:"invite-note",rows:3,placeholder:"Add a short note for the invitee (visible in the invitation email).",className:"w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors text-sm",...h("note",{maxLength:{value:500,message:"Note must be 500 characters or fewer"}})}),g.note&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(r,{className:"text-xs"}),g.note.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"invite-ttl",className:"block text-sm font-medium text-gray-700 mb-2",children:"Invitation Expiration"}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("select",{id:"invite-ttl",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors",...h("ttlHours",{required:!0,valueAsNumber:!0,validate:e=>e>0||"Expiration must be greater than zero"}),children:K.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsx("div",{children:e.jsx(n,{type:"submit",variant:"primary",size:"lg",className:"w-full sm:w-auto flex items-center justify-center gap-2",disabled:f,children:f?"Sending Invitation...":"Send Invitation"})})]})]})}function ee(){const{allUsers:s,loading:a,error:r}=function(){const{currentUser:e}=x(),{userProfile:s}=h(),[a,r]=t.useState([]),[i,n]=t.useState(!0),[l,d]=t.useState(null),c="super_admin"===s?.role;return t.useEffect(()=>{if(!e||!c)return r([]),void n(!1);try{const e=u(p(g,"users"),f("created_at","desc")),s=j(e,e=>{const s=e.docs.map(e=>({uid:e.id,...e.data(),created_at:e.data().created_at?.toDate?e.data().created_at.toDate():e.data().created_at,updated_at:e.data().updated_at?.toDate?e.data().updated_at.toDate():e.data().updated_at}));r(s),d(null),n(!1)},e=>{d(e.message||"Failed to fetch users"),n(!1)});return()=>s()}catch(s){d(s.message||"Failed to set up users listener"),n(!1)}},[e,c]),{allUsers:a,loading:i,error:l}}(),{updateUserRole:i}=h(),[l,d]=t.useState(null),[c,o]=t.useState("all"),m=async(e,s)=>{const t=s===b.ADMIN?"promote":"demote",a=s===b.ADMIN?"Admin":"Member";if(window.confirm(`Are you sure you want to ${t} ${e.name||e.email} to ${a}?`))try{d(e.uid),await i(e.uid,s),A.success(`Successfully ${t}d ${e.name||e.email} to ${a}`)}catch(r){A.error(r.message||`Failed to ${t} user`)}finally{d(null)}},D=t.useMemo(()=>"all"===c?s:"member"===c?s.filter(e=>e.role===b.MEMBER):"admin"===c?s.filter(e=>e.role===b.ADMIN):s,[s,c]),k=t.useMemo(()=>({total:s.length,members:s.filter(e=>e.role===b.MEMBER).length,admins:s.filter(e=>e.role===b.ADMIN).length,superAdmins:s.filter(e=>e.role===b.SUPER_ADMIN).length}),[s]);return a?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(y,{className:"w-6 h-6 text-primary animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading users..."})]}):r?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-800",children:[e.jsx("p",{className:"font-semibold",children:"Error loading users"}),e.jsx("p",{className:"text-sm",children:r})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:k.total})]}),e.jsx(N,{className:"w-8 h-8 text-gray-400"})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Members"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:k.members})]}),e.jsx(N,{className:"w-8 h-8 text-primary-light"})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Admins"}),e.jsx("p",{className:"text-2xl font-bold text-secondary-light",children:k.admins})]}),e.jsx(v,{className:"w-8 h-8 text-secondary-light"})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Super Admins"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:k.superAdmins})]}),e.jsx(v,{className:"w-8 h-8 text-red-400"})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"all"===c?"primary":"outline",size:"sm",onClick:()=>o("all"),children:["All (",k.total,")"]}),e.jsxs(n,{variant:"member"===c?"primary":"outline",size:"sm",onClick:()=>o("member"),children:["Members (",k.members,")"]}),e.jsxs(n,{variant:"admin"===c?"primary":"outline",size:"sm",onClick:()=>o("admin"),children:["Admins (",k.admins,")"]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===D.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-6 py-8 text-center text-gray-500",children:"No users found"})}):D.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-600",children:s.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(s.role===b.SUPER_ADMIN?"bg-red-100 text-red-800":s.role===b.ADMIN?"bg-secondary-light text-secondary-dark":"bg-primary-light text-secondary"),children:[s.role===b.SUPER_ADMIN&&e.jsx(v,{className:"w-3 h-3 mr-1"}),s.role===b.ADMIN&&e.jsx(v,{className:"w-3 h-3 mr-1"}),s.role===b.MEMBER&&e.jsx(N,{className:"w-3 h-3 mr-1"}),s.role?.replace("_"," ").toUpperCase()]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium "+("approved"===s.status?"bg-green-100 text-green-800":"pending"===s.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:s.status||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:s.role===b.SUPER_ADMIN?e.jsx("span",{className:"text-gray-400 text-xs",children:"Cannot modify"}):s.role===b.MEMBER?e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>m(s,b.ADMIN),disabled:l===s.uid,className:"inline-flex items-center gap-1",children:[l===s.uid?e.jsx(y,{className:"w-3 h-3 animate-spin"}):e.jsx(w,{className:"w-3 h-3"}),"Promote to Admin"]}):s.role===b.ADMIN?e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>m(s,b.MEMBER),disabled:l===s.uid,className:"inline-flex items-center gap-1",children:[l===s.uid?e.jsx(y,{className:"w-3 h-3 animate-spin"}):e.jsx(M,{className:"w-3 h-3"}),"Demote to Member"]}):null})]},s.uid))})]})})})]})}function se(){const d=a(),{approvedAdmins:o,isSuperAdmin:x,loading:h,error:u,removeAdmin:p}=D(),{invitations:g,pendingInvitations:f,loading:j,error:b,createAdminInvitation:w,cancelInvitation:M}=U({listen:!0}),[R,P]=t.useState(null),[z,T]=t.useState(null),H=e=>{if(!e)return"N/A";try{const s=e instanceof Date?e:new Date(e);return q(s,"MMM dd, yyyy • p")}catch{return"Invalid date"}},X=async e=>{const s=(e=>`${"undefined"!=typeof window?window.location.origin:""}/invite/${e}`)(e);try{if(navigator?.clipboard?.writeText)await navigator.clipboard.writeText(s);else{const e=document.createElement("textarea");e.value=s,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}A.success("Invitation link copied to clipboard.")}catch(t){A.error("Unable to copy invitation link. Please copy it manually.")}},B=t.useMemo(()=>o.filter(e=>"approved"===e.status),[o]),L=t.useMemo(()=>g.filter(e=>"accepted"===e.status).length,[g]),Y=t.useMemo(()=>g.filter(e=>"pending"===e.status&&e.expires_at&&$(e.expires_at)).length,[g]),Z=t.useMemo(()=>g.filter(e=>"cancelled"===e.status).length,[g]),O=t.useMemo(()=>g.filter(e=>"pending"!==e.status||e.expires_at&&$(e.expires_at)).slice(0,5),[g]);if(!x)return e.jsxs(e.Fragment,{children:[e.jsx(C,{title:"Admin Management - Access Denied",description:"Admin management page",noindex:!0}),e.jsx(F,{bgColor:"white",padding:"xl",children:e.jsxs(E,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>d("/admin"),className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Back to Dashboard"]})}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(v,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-red-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-red-700",children:"Only the super admin can access admin management. You can still access the admin dashboard to manage submissions."})]})]})})]});const V=s=>{const t=!!s.expires_at&&$(s.expires_at);let a=s.status;"pending"===s.status&&t&&(a="expired");const r={pending:{label:"Pending",classes:"bg-orange-100 text-orange-800 border border-orange-200"},accepted:{label:"Accepted",classes:"bg-green-100 text-green-800 border border-green-200"},cancelled:{label:"Cancelled",classes:"bg-gray-100 text-gray-700 border border-gray-200"},expired:{label:"Expired",classes:"bg-red-100 text-red-700 border border-red-200"}}[a]||{label:a,classes:"bg-gray-100 text-gray-700 border border-gray-200"};return e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${r.classes}`,children:r.label})};return e.jsxs(e.Fragment,{children:[e.jsx(C,{title:"Admin Management",description:"Manage admin invitations and approved administrators",noindex:!0}),e.jsx(F,{bgColor:"white",padding:"xl",children:e.jsxs(E,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>d("/admin"),className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Back to Dashboard"]})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Admin Management"}),e.jsx("p",{className:"text-gray-600",children:"Invite new administrators, monitor invitation activity, and manage active admin accounts."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-secondary-dark",children:"Active Invitations"}),e.jsx(I,{className:"w-5 h-5 text-secondary"})]}),e.jsx("p",{className:"text-2xl font-bold text-secondary-dark",children:f.length})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},className:"bg-accent border border-primary-light rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-secondary-dark",children:"Active Admins"}),e.jsx(N,{className:"w-5 h-5 text-primary"})]}),e.jsx("p",{className:"text-2xl font-bold text-secondary-dark",children:B.length})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-green-900",children:"Accepted Invites"}),e.jsx(i,{className:"w-5 h-5 text-green-600"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:L})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.3},className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-red-900",children:"Expired / Cancelled"}),e.jsx(m,{className:"w-5 h-5 text-red-600"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:Y+Z})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-8",children:[e.jsx(W,{onCreateInvitation:async e=>{try{const s=await w(e);return A.success("Admin invitation created successfully."),s}catch(s){throw A.error(s.message||"Unable to create invitation. Please try again."),s}}}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm p-6 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Pending Invitations"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[f.length," active"]})]}),j?e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx(y,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading invitations…"})]}):b?e.jsxs("div",{className:"flex items-start gap-2 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700",children:[e.jsx(r,{className:"mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-900",children:"Unable to load invitations"}),e.jsx("p",{children:b})]})]}):0===f.length?e.jsxs("div",{className:"bg-gray-50 border border-dashed border-gray-200 rounded-lg p-6 text-center text-sm text-gray-600",children:[e.jsx("p",{children:"No pending invitations at the moment."}),e.jsx("p",{className:"mt-1",children:"Use the form to the left to invite a new administrator."})]}):e.jsx("div",{className:"space-y-4",children:f.map(s=>{const t=s.expires_at?new Date(s.expires_at):null,a=t?J(t,{addSuffix:!0}):"No expiration";return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50 hover:border-indigo-200 transition-colors",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.email}),s.invitee_name&&e.jsx("p",{className:"text-sm text-gray-600",children:s.invitee_name}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-x-4 gap-y-2 text-xs text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(c,{className:"w-3 h-3"}),"Invited by ",s.invited_by_name||s.invited_by||"Admin"]}),s.created_at&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),H(s.created_at)]}),t&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(m,{className:"w-3 h-3"}),"Expires ",a]})]})]}),V(s)]}),s.note&&e.jsx("div",{className:"mt-3 text-xs bg-white border border-gray-200 rounded-md p-3 text-gray-700 whitespace-pre-wrap",children:s.note}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>X(s.token),className:"flex items-center gap-2",children:[e.jsx(l,{className:"w-4 h-4"}),"Copy Link"]}),e.jsx(n,{variant:"ghost",size:"sm",disabled:z===s.id,onClick:()=>(async e=>{if(!e?.id)return;if(window.confirm(`Cancel invitation for ${e.email}? The link will stop working immediately.`))try{T(e.id),await M(e.id),A.success("Invitation cancelled.")}catch(s){A.error(s.message||"Unable to cancel invitation.")}finally{T(null)}})(s),className:"flex items-center gap-2 text-red-600 hover:text-red-700",children:z===s.id?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 animate-spin"}),"Cancelling…"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4"}),"Cancel Invite"]})})]})]},s.id)})})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Recent Invitation Activity"}),0===O.length?e.jsx("p",{className:"text-sm text-gray-600",children:"No invitation activity yet."}):e.jsx("div",{className:"space-y-3",children:O.map(s=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 border border-gray-100 rounded-lg p-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-600",children:["accepted"===s.status&&"Invitation accepted","cancelled"===s.status&&"Invitation cancelled","pending"===s.status&&s.expires_at&&$(s.expires_at)&&"Invitation expired"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.created_at&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Sent ",J(new Date(s.created_at),{addSuffix:!0})]}),V(s)]})]},`history-${s.id}`))})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Approved Administrators"}),h?e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx(y,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading administrators…"})]}):u?e.jsxs("div",{className:"flex items-start gap-2 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700",children:[e.jsx(r,{className:"mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-900",children:"Unable to load admins"}),e.jsx("p",{children:u})]})]}):0===B.length?e.jsx("div",{className:"bg-gray-50 border border-dashed border-gray-200 rounded-lg p-6 text-center text-sm text-gray-600",children:"No approved administrators yet."}):e.jsx("div",{className:"space-y-3",children:B.map(s=>e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.name||s.email}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(c,{className:"w-4 h-4"}),s.email]}),s.approved_at&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4"}),"Approved ",H(s.approved_at)]}),s.approved_by&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4"}),"Approved by ",s.approved_by]})]})]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>(async(e,s)=>{if(window.confirm(`Are you sure you want to remove ${s||e} as an admin?`))try{P(e),await p(e),A.success("Admin access revoked successfully")}catch(t){A.error(t.message||"Failed to remove admin")}finally{P(null)}})(s.email,s.name),disabled:R===s.email,className:"flex items-center gap-2",children:R===s.email?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 animate-spin"}),"Processing…"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4"}),"Remove Admin"]})})]},s.email))})]}),e.jsxs("div",{className:"mt-12",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"User Role Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage user roles across the system. Promote members to admins or demote admins to members."})]}),e.jsx(ee,{})]})]})})]})}export{se as default};
