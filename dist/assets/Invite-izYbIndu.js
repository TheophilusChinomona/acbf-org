import{j as e}from"./ui-vendor-D2jIcmjW.js";import{a as s,h as t,c as a,L as r}from"./react-vendor-C9V0vZuX.js";import{w as i,t as n,F as o,a3 as l,T as d,a4 as c,B as m,h as x,m as p,aa as u}from"./index-LZoYdwKt.js";import{S as h,C as g}from"./SEO-DVvlMMot.js";import{S as f}from"./Section-B5vjyEy3.js";import{u as j}from"./form-vendor-DygO8_bV.js";import{u as v,i as b}from"./useAdminInvitations-DyC9LJpv.js";const y={name:"",password:"",confirmPassword:""};function w({token:t,invitation:a,onAccepted:r}){const{acceptInvitation:x}=v(),{register:p,handleSubmit:u,setError:h,clearErrors:g,reset:f,watch:b,formState:{errors:w}}=j({defaultValues:y}),[N,k]=s.useState(null),[P,C]=s.useState(null),[I,A]=s.useState(!1),S=b("password"),F=b("confirmPassword");s.useEffect(()=>{a&&f({...y,name:a.invitee_name||""})},[a,f]),s.useEffect(()=>{S&&F&&(S!==F?h("confirmPassword",{type:"manual",message:"Passwords do not match"}):"manual"===w.confirmPassword?.type&&g("confirmPassword"))},[S,F,h,g,w.confirmPassword]);const E=a?.expires_at?new Date(a.expires_at).toLocaleString():null;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm p-6 space-y-6 max-w-2xl mx-auto",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Accept Admin Invitation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Complete the form below to create your administrator account using the invitation details provided."})]}),a&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-3 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500 tracking-wide",children:"Invitation Email"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{className:"text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500 tracking-wide",children:"Invited By"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.invited_by_name||a.invited_by||"Admin"})]})]}),E&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(o,{}),e.jsxs("span",{children:["Invitation expires on ",E,"."]})]}),a.note&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-xs font-semibold uppercase text-gray-500 tracking-wide mb-1",children:"Message"}),e.jsx("p",{className:"bg-white border border-gray-200 rounded-md p-3 text-gray-700 whitespace-pre-wrap",children:a.note})]})]}),"success"===P&&e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-green-50 border border-green-200 rounded-lg text-sm text-green-700",children:[e.jsx(l,{className:"text-lg flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Invitation Accepted"}),e.jsx("p",{children:"Your administrator account has been created successfully. You can proceed to the admin dashboard."})]})]}),N&&e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700",children:[e.jsx(d,{className:"text-lg flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-900",children:"Unable to complete registration"}),e.jsx("p",{children:N})]})]}),e.jsxs("form",{onSubmit:u(async e=>{if(t)if(e.password===e.confirmPassword){A(!0),k(null),C(null);try{await x({token:t,password:e.password,name:e.name}),C("success"),r&&r()}catch(s){k(s.message||"Failed to accept invitation. Please try again or request a new invite."),C("error")}finally{A(!1)}}else h("confirmPassword",{type:"manual",message:"Passwords do not match"});else k("Invitation token is missing or invalid.")}),className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"invite-name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{id:"invite-name",type:"text",placeholder:"Your full name",autoComplete:"name",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors "+(w.name?"border-red-500":"border-gray-300"),...p("name",{required:"Please provide your name",minLength:{value:2,message:"Name must be at least 2 characters long"},maxLength:{value:120,message:"Name must be 120 characters or fewer"}})})]}),w.name&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(d,{className:"text-xs"}),w.name.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"invite-password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{id:"invite-password",type:"password",placeholder:"Create a password",autoComplete:"new-password",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors "+(w.password?"border-red-500":"border-gray-300"),...p("password",{required:"Password is required",minLength:{value:6,message:"Password must be at least 6 characters long"}})})]}),w.password&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(d,{className:"text-xs"}),w.password.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"invite-confirm-password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{id:"invite-confirm-password",type:"password",placeholder:"Re-enter your password",autoComplete:"new-password",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors "+(w.confirmPassword?"border-red-500":"border-gray-300"),...p("confirmPassword",{required:"Please confirm your password"})})]}),w.confirmPassword&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(d,{className:"text-xs"}),w.confirmPassword.message]})]}),e.jsx(m,{type:"submit",variant:"primary",size:"lg",className:"w-full sm:w-auto flex items-center justify-center gap-2",disabled:I||"success"===P,children:I?"Creating Account...":"Create Admin Account"})]})]})}function N(){const{token:n}=t(),o=a(),{getInvitationByToken:c}=v(),[m,j]=s.useState(!0),[y,N]=s.useState(null),[k,P]=s.useState(null),[C,I]=s.useState(!1),[A,S]=s.useState(!1);s.useEffect(()=>{let e=!0;return(async()=>{if(!n)return N("Invitation token is missing."),void j(!1);j(!0),N(null);try{const s=await c(n);if(!s)throw new Error("Invitation not found. It may have been used or revoked.");const t=!!s.expires_at&&b(new Date(s.expires_at));e&&(P(s),I(t),"pending"!==s.status?N("This invitation has already been used or is no longer active."):t&&N("This invitation has expired. Please contact the administrator for a new invite."))}catch(s){e&&(P(null),N(s.message||"Unable to load invitation details."))}finally{e&&j(!1)}})(),()=>{e=!1}},[c,n]);const F=s.useCallback(()=>{S(!0),setTimeout(()=>{o("/admin",{replace:!0})},2e3)},[o]),E=s.useMemo(()=>"undefined"==typeof window?"":`${window.location.origin}/invite/${n||""}`,[n]);return e.jsxs(e.Fragment,{children:[e.jsx(h,{title:"Admin Invitation",description:"Accept your ACBF administrator invitation to gain access to the admin dashboard.",url:E}),e.jsx(f,{bgColor:"gray",padding:"lg",children:e.jsxs(g,{className:"max-w-4xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(r,{to:"/",className:"inline-flex items-center gap-2 text-sm text-primary hover:text-primary/80 font-medium",children:[e.jsx(x,{className:"w-4 h-4"}),"Back to homepage"]})}),e.jsxs("div",{className:"bg-white shadow-xl border border-gray-200 rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary to-secondary-light px-6 py-10 text-white",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(p,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold",children:"Administrator Invitation"}),e.jsx("p",{className:"mt-3 text-white/80 text-sm md:text-base",children:"Use the secure form below to create your administrator account. This invitation is exclusive to the email address provided."})]})]})}),e.jsxs("div",{className:"px-6 py-8 space-y-6",children:[m&&e.jsxs("div",{className:"p-6 bg-gray-50 border border-gray-200 rounded-lg flex items-center gap-3 text-gray-600",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-primary",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Verifying invitation details…"})]}),!m&&y&&e.jsxs("div",{className:"p-6 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3 text-sm text-red-700",children:[e.jsx(d,{className:"text-lg flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-900",children:"Unable to proceed"}),e.jsx("p",{children:y}),e.jsxs("p",{className:"mt-3 text-xs text-red-600",children:["Need help?"," ",e.jsx(r,{to:"/contact",className:"underline font-medium",children:"Contact the ACBF team"})," ","for assistance."]})]})]}),!m&&!y&&k&&e.jsx(w,{token:n,invitation:k,onAccepted:F}),A&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg flex items-start gap-3 text-sm text-green-700",children:[e.jsx(l,{className:"text-lg flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Redirecting to admin dashboard…"}),e.jsx("p",{children:"You will be redirected automatically. If not, please click the button below."}),e.jsx("div",{className:"mt-3",children:e.jsxs(r,{to:"/admin",className:"inline-flex items-center gap-2 text-sm font-medium text-primary hover:text-primary/80",children:["Go to admin dashboard",e.jsx(i,{className:"w-4 h-4"})]})})]})]}),!m&&k&&"pending"===k.status&&!C&&e.jsxs("div",{className:"p-4 bg-accent border border-primary-light rounded-lg flex items-start gap-3 text-xs text-primary-dark",children:[e.jsx(u,{className:"text-sm flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-secondary-dark",children:"Need more time?"}),e.jsx("p",{children:"If you are unable to complete this now, keep this page bookmarked. The invitation will remain valid until it expires."})]})]})]})]})]})})]})}export{N as default};
