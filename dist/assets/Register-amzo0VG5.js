import{j as e}from"./ui-vendor-D2jIcmjW.js";import{c as s,a,h as r,L as t}from"./react-vendor-C9V0vZuX.js";import{R as l,a2 as i,F as o,T as n,a3 as c,t as d,w as m,a4 as x,B as p,a5 as u,Z as h,a6 as f,a7 as g,a8 as b,W as y,a9 as j,A as w,h as N}from"./index-CSaj8tEt.js";import{S as v,C as k}from"./SEO-CwNgP1KE.js";import{S as P}from"./Section-B5vjyEy3.js";import{u as C}from"./form-vendor-DygO8_bV.js";const A={name:"",email:"",password:"",confirmPassword:""};function S({applicationId:r=null}){const t=s(),{register:j,error:w}=l(),{createUserProfile:N}=i(),[v,k]=a.useState(null),[P,S]=a.useState(!!r),[F,E]=a.useState(null),[_,B]=a.useState(null),[M,R]=a.useState(!1),[Y,$]=a.useState(""),[q,I]=a.useState(!1),{register:z,handleSubmit:L,formState:{errors:T},watch:U,reset:W,setError:Z,clearErrors:O}=C({defaultValues:A}),V=U("password"),H=U("confirmPassword"),D=a.useMemo(()=>Boolean(r),[r]);a.useEffect(()=>{if(!r)return;let e=!0;return(async()=>{S(!0),E(null);try{const s=u(h,"membership_applications",r),a=await f(s);if(!a.exists())throw new Error("Membership application not found. Please make sure you used the correct link.");const t={id:a.id,...a.data()};t.account_created&&I(!0),e&&(k(t),W({...A,name:t.name||"",email:t.email||""}))}catch(s){e&&E(s.message||"Unable to load membership application.")}finally{e&&S(!1)}})(),()=>{e=!1}},[r,W]),a.useEffect(()=>{V&&H&&(V!==H?Z("confirmPassword",{type:"manual",message:"Passwords do not match"}):"manual"===T.confirmPassword?.type&&O("confirmPassword"))},[V,H,Z,O,T.confirmPassword]);return P?e.jsx("div",{className:"w-full p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-primary",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Loading membership application..."})]})}):q?e.jsx("div",{className:"w-full p-6 bg-accent border border-primary-light rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3 text-primary-dark",children:[e.jsx(o,{className:"text-xl flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-secondary-dark mb-1",children:"Account Already Created"}),e.jsx("p",{className:"text-sm",children:"An account has already been created for this membership application. If you need help accessing your account, please try resetting your password or contact support."})]})]})}):F&&!_?e.jsx("div",{className:"w-full p-6 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(n,{className:"text-red-600 text-xl flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-1",children:"Unable to Continue"}),e.jsx("p",{className:"text-sm text-red-700",children:F})]})]})}):e.jsxs("div",{className:"w-full",children:["success"===_&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg flex items-start gap-3",children:[e.jsx(c,{className:"text-green-600 text-xl flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-1",children:"Registration Successful!"}),e.jsx("p",{className:"text-sm text-green-700",children:Y}),e.jsx("p",{className:"text-xs text-green-700 mt-2",children:"You will be redirected shortly. If nothing happens, please navigate to the member portal to check your status."})]})]}),("error"===_||w)&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3",children:[e.jsx(n,{className:"text-red-600 text-xl flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-1",children:"Registration Failed"}),e.jsx("p",{className:"text-sm text-red-700",children:F||w||"Please double-check your details and try again."})]})]}),v&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Application Details"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",v.name||"Not provided"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",v.email||"Not provided"]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"These details will be used for your member account."})]}),e.jsxs("form",{onSubmit:L(async e=>{if(e.password===e.confirmPassword){R(!0),B(null),$("");try{const a=e.email.trim(),l=e.name.trim(),i=await j(a,e.password);if(await N(i.uid,{email:a,name:l||a,role:g.MEMBER,status:"pending",member_application_id:r||null}),r){const e=u(h,"membership_applications",r);try{await b(e,{user_id:i.uid,account_created:!0,account_created_at:y()})}catch(s){}}B("success"),$(r?"Account created! Your membership application is under review. You will receive an email once a decision is made.":"Account created! You can log in once your membership is approved."),W(A),setTimeout(()=>{t("/member/pending",{replace:!0})},2e3)}catch(a){let e="An error occurred while creating your account. Please try again.";"auth/email-already-in-use"===a.code?e="An account with this email already exists. Try logging in instead.":"auth/invalid-email"===a.code?e="Please enter a valid email address.":"auth/weak-password"===a.code?e="Password must be at least 6 characters.":a.message&&(e=a.message),B("error"),E(e)}finally{R(!1)}}else Z("confirmPassword",{type:"manual",message:"Passwords do not match"})}),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{...z("name",{required:"Full name is required",minLength:{value:2,message:"Name must be at least 2 characters"}}),type:"text",id:"name",placeholder:"Your Full Name",autoComplete:"name",className:`w-full pl-10 pr-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors ${T.name?"border-red-500":"border-gray-300"} ${D?"bg-gray-100 cursor-not-allowed":""}`,readOnly:D})]}),T.name&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(n,{className:"text-xs"}),T.name.message]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:["Email Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{...z("email",{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),type:"email",id:"email",placeholder:"your.email@example.com",autoComplete:"email",className:`w-full pl-10 pr-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors ${T.email?"border-red-500":"border-gray-300"} ${D?"bg-gray-100 cursor-not-allowed":""}`,readOnly:D})]}),T.email&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(n,{className:"text-xs"}),T.email.message]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:["Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{...z("password",{required:"Password is required",minLength:{value:6,message:"Password must be at least 6 characters"}}),type:"password",id:"password",placeholder:"Create a password",autoComplete:"new-password",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors "+(T.password?"border-red-500":"border-gray-300")})]}),T.password&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(n,{className:"text-xs"}),T.password.message]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:["Confirm Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{...z("confirmPassword",{required:"Please confirm your password"}),type:"password",id:"confirmPassword",placeholder:"Re-enter your password",autoComplete:"new-password",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors "+(T.confirmPassword?"border-red-500":"border-gray-300")})]}),T.confirmPassword&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(n,{className:"text-xs"}),T.confirmPassword.message]})]}),e.jsx("div",{children:e.jsx(p,{type:"submit",variant:"primary",size:"lg",fullWidth:!0,disabled:M,className:"flex items-center justify-center gap-2",children:M?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating Account..."]}):"Create Account"})})]})]})}function F(){const{applicationId:s}=r(),l=a.useMemo(()=>s?{title:"Complete Your Membership Registration",description:"Create your ACBF member account using the details from your membership application.",helper:"Your application details are pre-filled. Simply create a secure password to access the member portal once approved."}:{title:"Create Your ACBF Account",description:"Register for an ACBF member account to access exclusive member resources and updates.",helper:"If you have already submitted a membership application, use the link from your confirmation email to pre-fill your details."},[s]),i="undefined"!=typeof window?`${window.location.origin}/register${s?`/${s}`:""}`:"";return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Member Registration",description:l.description,url:i}),e.jsx(P,{bgColor:"gray",padding:"lg",children:e.jsx(k,{className:"max-w-4xl",children:e.jsxs("div",{className:"bg-white shadow-xl border border-gray-200 rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary to-secondary px-6 py-10 text-white",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold",children:l.title}),e.jsx("p",{className:"mt-3 text-white/80 text-sm md:text-base",children:l.description})]})]})}),e.jsxs("div",{className:"px-6 py-8 space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-3 bg-accent border border-blue-100 rounded-xl p-4",children:[e.jsx(w,{className:"text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-primary-dark",children:[e.jsx("p",{className:"font-medium text-secondary-dark",children:"Secure Registration"}),e.jsx("p",{className:"mt-1",children:l.helper})]})]}),!s&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded-xl p-4",children:[e.jsx("p",{className:"font-medium text-gray-900 mb-1",children:"Already applied for membership?"}),e.jsx("p",{children:"Use the registration link sent to your email after submitting your application to ensure your account is linked correctly."})]}),e.jsx(S,{applicationId:s||null}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 pt-4 border-t border-gray-200",children:[e.jsxs(t,{to:"/becoming-a-member",className:"inline-flex items-center gap-2 text-primary hover:text-primary/80 font-medium",children:[e.jsx(N,{className:"h-4 w-4"}),"Back to membership info"]}),e.jsxs("p",{children:["Need help?"," ",e.jsx(t,{to:"/contact",className:"text-primary hover:text-primary/80 font-medium",children:"Contact us"})]})]})]})]})})})]})}export{F as default};
