import{j as e,m as s}from"./ui-vendor-D2jIcmjW.js";import{c as a,a as t}from"./react-vendor-C9V0vZuX.js";import{ab as i,B as l,h as r,A as n,a9 as d,R as c,L as m,m as o,w as x,t as p,u as h,ah as j,a8 as g,i as b,ai as u,aa as y,aj as N,ak as f}from"./index-Dan2u6DX.js";import{a as v,S as w,C as A}from"./SEO-SZSb_e0q.js";import{S as k}from"./StatusBadge-Bw4NcJ13.js";import{f as C}from"./format-4F2ZJGS8.js";import"./form-vendor-BOV3nkk-.js";function S(){const S=a(),{adminApplications:_,approvedAdmins:D,isSuperAdmin:F,loading:P,error:z,approveAdminApplication:$,denyAdminApplication:R,removeAdmin:B}=i(),[M,E]=t.useState("applications"),[I,T]=t.useState(null),[H,L]=t.useState(new Set),[O,U]=t.useState(!1),[Y,q]=t.useState(null),[G,J]=t.useState(!1),K=e=>{if(!e)return"N/A";try{const s=e instanceof Date?e:e.toDate?e.toDate():new Date(e);return C(s,"MMM dd, yyyy HH:mm")}catch(s){return"Invalid date"}},Q=async(e,s)=>{if(window.confirm(`Are you sure you want to remove ${s||e} as an admin?`))try{T(e),await B(e),y.success("Admin access revoked successfully")}catch(a){y.error(a.message||"Failed to remove admin")}finally{T(null)}},V=e=>{H.size===e.length?L(new Set):L(new Set(e.map(e=>e.id)))},W=e=>{E(e),L(new Set),q(null)};if(!F)return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Admin Management - Access Denied",description:"Admin management page",noindex:!0}),e.jsx(w,{bgColor:"white",padding:"xl",children:e.jsxs(A,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>S("/admin"),className:"flex items-center gap-2",children:[e.jsx(r,{className:"w-4 h-4"}),"Back to Dashboard"]})}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(n,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-red-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-red-700",children:"Only the super admin can access admin management. You can still access the admin dashboard to manage submissions."})]})]})})]});const X=_.filter(e=>"pending"===e.status),Z=_.filter(e=>"approved"===e.status),ee=_.filter(e=>"denied"===e.status),se=D.filter(e=>"approved"===e.status);return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Admin Management",description:"Manage admin applications and approved administrators",noindex:!0}),e.jsx(w,{bgColor:"white",padding:"xl",children:e.jsxs(A,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>S("/admin"),className:"flex items-center gap-2",children:[e.jsx(r,{className:"w-4 h-4"}),"Back to Dashboard"]})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Admin Management"}),e.jsx("p",{className:"text-gray-600",children:"Review admin applications and manage approved administrators"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-900",children:"Pending Applications"}),e.jsx(d,{className:"w-5 h-5 text-yellow-600"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:X.length})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-green-900",children:"Approved Applications"}),e.jsx(c,{className:"w-5 h-5 text-green-600"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:Z.length})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-red-900",children:"Denied Applications"}),e.jsx(m,{className:"w-5 h-5 text-red-600"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:ee.length})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.3},className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-900",children:"Active Admins"}),e.jsx(o,{className:"w-5 h-5 text-blue-600"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:se.length})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"border-b border-gray-200 overflow-x-auto -mx-4 px-4 md:mx-0 md:px-0",children:e.jsxs("nav",{className:"flex gap-2 flex-nowrap min-w-max md:min-w-0","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>W("applications"),className:"px-6 py-3 text-sm font-medium border-b-2 transition-colors "+("applications"===M?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{}),e.jsx("span",{children:"Applications"}),X.length>0&&e.jsx("span",{className:"bg-yellow-100 text-yellow-800 text-xs font-semibold px-2 py-0.5 rounded-full",children:X.length})]})}),e.jsx("button",{onClick:()=>W("admins"),className:"px-6 py-3 text-sm font-medium border-b-2 transition-colors "+("admins"===M?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{}),e.jsx("span",{children:"Approved Admins"})]})})]})})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:P?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(d,{className:"w-8 h-8 text-gray-400 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]}):z?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-red-800 font-medium mb-1",children:"Error loading data"}),e.jsx("p",{className:"text-red-600 text-sm",children:z})]}):"applications"===M?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Admin Applications"}),X.length>0&&e.jsx("div",{className:"flex items-center gap-3",children:H.size>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[H.size," selected"]}),e.jsx(l,{variant:"primary",size:"sm",onClick:async()=>{if(0===H.size)return;const e=Array.from(H);U(!0);let s=0,a=0;try{for(const i of e)try{await $(i),s++}catch(t){a++}s>0&&y.success(`Successfully approved ${s} application${1!==s?"s":""}`),a>0&&y.error(`Failed to approve ${a} application${1!==a?"s":""}`),L(new Set)}finally{U(!1)}},disabled:O,children:O?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"animate-spin mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"mr-2"}),"Bulk Approve"]})}),e.jsxs(l,{variant:"outline",size:"sm",onClick:async()=>{if(0===H.size)return;const e=window.prompt("Please provide a reason for denial (optional):");if(null===e)return;const s=Array.from(H);U(!0);let a=0,t=0;try{for(const l of s)try{await R(l,e||""),a++}catch(i){t++}a>0&&y.success(`Successfully denied ${a} application${1!==a?"s":""}`),t>0&&y.error(`Failed to deny ${t} application${1!==t?"s":""}`),L(new Set)}finally{U(!1)}},disabled:O,children:[e.jsx(m,{className:"mr-2"}),"Bulk Deny"]})]})})]}),0===_.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(x,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No admin applications found"})]}):e.jsxs("div",{className:"space-y-4",children:[X.length>0&&e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-gray-200",children:[e.jsx("input",{type:"checkbox",checked:H.size===X.length&&X.length>0,onChange:()=>V(X),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("label",{className:"text-sm font-medium text-gray-700 cursor-pointer",onClick:()=>V(X),children:["Select All (",X.length," pending)"]})]}),_.map(s=>e.jsx("div",{onClick:()=>q({type:"application",data:s}),className:"bg-gray-50 border rounded-lg p-4 cursor-pointer hover:border-blue-300 hover:shadow-md transition-all "+(H.has(s.id)?"border-blue-500 bg-blue-50":"border-gray-200"),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:["pending"===s.status&&e.jsx("input",{type:"checkbox",checked:H.has(s.id),onChange:e=>{var a;e.stopPropagation(),a=s.id,L(e=>{const s=new Set(e);return s.has(a)?s.delete(a):s.add(a),s})},onClick:e=>e.stopPropagation(),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 flex-shrink-0 mt-1"}),e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(p,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("div",{className:"hidden md:flex items-center gap-4 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"w-4 h-4"}),s.email]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-4 h-4"}),K(s.created_at)]})]})]}),e.jsx(k,{status:s.status})]}),e.jsxs("div",{className:"ml-0 md:ml-[52px] mt-3 hidden md:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Reason:"}),e.jsx("p",{className:"text-sm text-gray-600 bg-white rounded p-3 border border-gray-200",children:s.reason})]}),s.approved_by&&e.jsx("p",{className:"hidden md:block text-xs text-gray-500 mt-2 ml-[52px]",children:"approved"===s.status?`Approved by: ${s.approved_by}`:`Denied by: ${s.denied_by||s.approved_by}`}),s.denial_reason&&e.jsxs("div",{className:"hidden md:block ml-[52px] mt-2",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 mb-1",children:"Denial Reason:"}),e.jsx("p",{className:"text-xs text-red-600",children:s.denial_reason})]})]}),"pending"===s.status&&e.jsxs("div",{className:"flex gap-2",onClick:e=>e.stopPropagation(),children:[e.jsx(l,{variant:"primary",size:"sm",onClick:e=>{e.stopPropagation(),(async e=>{try{T(e),await $(e),y.success("Admin application approved successfully!")}catch(s){y.error(s.message||"Failed to approve application")}finally{T(null)}})(s.id)},disabled:I===s.id,children:I===s.id?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"animate-spin mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"mr-2"}),"Approve"]})}),e.jsxs(l,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),(async e=>{const s=window.prompt("Please provide a reason for denial (optional):");if(null!==s)try{T(e),await R(e,s||""),y.success("Admin application denied")}catch(a){y.error(a.message||"Failed to deny application")}finally{T(null)}})(s.id)},disabled:I===s.id,children:[e.jsx(m,{className:"mr-2"}),"Deny"]})]})]})},s.id))]})]}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Approved Administrators"}),0===se.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(o,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No approved admins found"})]}):e.jsx("div",{className:"space-y-3",children:se.map(s=>e.jsxs("div",{onClick:()=>q({type:"admin",data:s}),className:"bg-gray-50 border border-gray-200 rounded-lg p-4 flex items-center justify-between cursor-pointer hover:border-blue-300 hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(n,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("div",{className:"hidden md:flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"w-4 h-4"}),s.email]}),s.approved_at&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-4 h-4"}),"Approved: ",K(s.approved_at)]})]}),s.approved_by&&e.jsxs("p",{className:"hidden md:block text-xs text-gray-500 mt-1",children:["Approved by: ",s.approved_by]})]})]}),e.jsx(l,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),Q(s.email,s.name)},disabled:I===s.email,children:I===s.email?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"animate-spin mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"mr-2"}),"Remove"]})})]},s.email))})]})})]})}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>q(null),children:e.jsxs(s.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},onClick:e=>e.stopPropagation(),className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"application"===Y.type?"Application Details":"Admin Details"}),e.jsx("button",{onClick:()=>q(null),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close",children:e.jsx(g,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-4",children:"Basic Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(p,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Name"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:Y.data.name})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(x,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Email"}),e.jsx("p",{className:"text-base text-gray-900 break-all",children:Y.data.email})]})]}),"application"===Y.type&&Y.data.reason&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(b,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Reason for Application"}),e.jsx("p",{className:"text-base text-gray-900 whitespace-pre-wrap bg-gray-50 rounded-lg p-3 border border-gray-200",children:Y.data.reason})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-4",children:"Status & Timeline"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(k,{status:Y.data.status})}),Y.data.created_at&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Application Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:K(Y.data.created_at)})]})]}),Y.data.approved_at&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Approved Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:K(Y.data.approved_at)})]})]}),Y.data.approved_by&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"approved"===Y.data.status?"Approved by":"Denied by"}),e.jsx("p",{className:"text-sm text-gray-900",children:Y.data.approved_by||Y.data.denied_by})]})]}),Y.data.denial_reason&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 mb-1",children:"Denial Reason"}),e.jsx("p",{className:"text-sm text-red-600",children:Y.data.denial_reason})]})]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(l,{variant:"primary",onClick:()=>(async(e,s)=>{if(window.confirm(`Send password reset email to ${s||e}?`))try{J(!0),await N(f,e),y.success(`Password reset email sent to ${e}`),q(null)}catch(a){let e="Failed to send password reset email.";"auth/user-not-found"===a.code?e="User not found. They may not have a Firebase Auth account yet.":"auth/invalid-email"===a.code?e="Invalid email address.":a.message&&(e=a.message),y.error(e)}finally{J(!1)}})(Y.data.email,Y.data.name),disabled:G,className:"w-full sm:w-auto",children:G?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"animate-spin mr-2"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"mr-2"}),"Send Password Reset Email"]})}),"admin"===Y.type&&e.jsxs(l,{variant:"outline",onClick:()=>{q(null),Q(Y.data.email,Y.data.name)},disabled:I===Y.data.email,className:"w-full sm:w-auto",children:[e.jsx(j,{className:"mr-2"}),"Remove Admin"]})]})})]})]})})]})}export{S as default};
